<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>欢迎</title>
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <style>
        .el-header, .el-footer {
          background-color: #B3C0D1;
          color: #333;
          text-align: center;
          line-height: 60px;
        }
        
        .el-aside {
          background-color: #fcfcfc;
          color: #333;
          text-align: center;
          line-height: 200px;
        }
        
        .el-main {
          background-color: #E9EEF3;
          color: #333;
          text-align: center;
          line-height: 160px;
        }
        
        body > .el-container {
          margin-bottom: 40px;
        }
        
        .el-container:nth-child(5) .el-aside,
        .el-container:nth-child(6) .el-aside {
          line-height: 260px;
        }
        
        .el-container:nth-child(7) .el-aside {
          line-height: 320px;
        }
      </style>
</head>
<body>
<div id="app">
    <div class="el-container" style="border-radius: 1px;">
        <div class="el-header" style="display: flex; justify-content: space-between; margin-bottom: 10px;">
            <span style="font-size: larger;">welcome</span>
            <div>
                <a href="#" class="el-link" style="text-decoration: none;">链接1</a>
                <a href="#" class="el-link" style="text-decoration: none;">链接2</a>
                <a href="#" class="el-link" style="text-decoration: none;">链接3</a>
                <a href="#" class="el-link" style="text-decoration: none;">链接4</a>
            </div>
        </div>
        <div class="el-container" style="height: 800px;">
            <div class="el-aside" style="border-radius: 1px;">
                <div>
                    <button @click="load">新增对话</button>
                    <input v-model="input" placeholder="请输入内容">
                    <el-menu>
                        <el-submenu index="1">
                            <template slot="title"><i class="el-icon-message"></i>浏览历史</template>
                            <el-menu-item-group>
                                <!-- 在这里插入 Django 渲染的浏览历史部分 -->
                                {% for item in browsing_history %}
                                    <el-menu-item index="1-{{ forloop.counter }}">{{ item }}</el-menu-item>
                                {% endfor %}
                            </el-menu-item-group>
                        </el-submenu>
                    </el-menu>
                </div>
            </div>
            <div class="el-main" style="border-radius: 1px;">
                <div class="box-card" style="height: 300px; line-height: 500px;">
                    这是对话框
                </div>
                <div style="display: flex; justify-content: center;">
                    <textarea rows="5" placeholder="请输入内容"></textarea>
                    <button>发送</button>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
<script src="https://unpkg.com/vue@2/dist/vue.js"></script>
<script src="https://unpkg.com/element-ui/lib/index.js"></script>
<script>
    new Vue({
        el: '#app',
        data: function() {
            return {
                count: 0,
                input: ''
            }
        },
        methods: {
            load() {
                if (this.count < 20) {
                    this.count += 2
                }
            }
        }
    })


    // 假设通过点击按钮触发新增对话操作
document.getElementById('add-dialog-btn').addEventListener('click', function() {
    var content = document.getElementById('dialog-content').value;  // 获取用户输入的对话内容
    // 发送 POST 请求到 add_dialog 路由
    fetch('/add_dialog/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')  // 获取 CSRF token
        },
        body: JSON.stringify({'content': content})
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert(data.message);  // 显示成功提示
        } else {
            alert(data.message);  // 显示错误提示
        }
    })
    .catch(error => {
        console.error('Error:', error);
    });
});

    // 发送消息按钮的点击事件
    document.getElementById('send-message-btn').addEventListener('click', function() {
        var userMessage = document.getElementById('user-message').value;  // 获取用户输入的消息
        // 发送 POST 请求到 chat_with_ai 路由
        fetch('/chat_with_ai/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken')  // 获取 CSRF token
            },
            body: JSON.stringify({'message': userMessage})
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // 将 AI 模型的响应显示在 AI 的回复文本框中
                document.getElementById('ai-response').value = data.message;
            } else {
                alert('发送消息失败: ' + data.message);
            }
        })
        .catch(error => {
            console.error('发送消息失败:', error);
        });
    });
</script>
</html>
